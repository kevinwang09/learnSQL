<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Kevin Wang Ph.D." />


<title>Guiding principles</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Learning SQL</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://kevinwang09.github.io/learnSQL/guides.html">Guiding principles</a>
    </li>
    <li>
      <a href="https://kevinwang09.github.io/learnSQL/basic_ddl.html">Basic data creation</a>
    </li>
    <li>
      <a href="https://kevinwang09.github.io/learnSQL/basic_dml.html">Basic data manipulation</a>
    </li>
    <li>
      <a href="https://kevinwang09.github.io/learnSQL/join.html">Join operations</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Intermediates
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://kevinwang09.github.io/learnSQL/subqueries.html">Subqueries - case when, with</a>
    </li>
    <li>
      <a href="https://kevinwang09.github.io/learnSQL/window.html">Window</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/kevinwang09/learnSQL">
    <span class="fa fa-code"></span>
     
    Source code
  </a>
</li>
<li>
  <a href="https://kevinwangstats.com">
    <span class="fa fa-user-tie"></span>
     
    About me
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Guiding principles</h1>
<h4 class="author">Kevin Wang Ph.D.</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#why-use-relational-database"
id="toc-why-use-relational-database"><span
class="toc-section-number">1</span> Why use relational
database?</a></li>
<li><a href="#connection-to-a-database"
id="toc-connection-to-a-database"><span
class="toc-section-number">2</span> Connection to a database</a></li>
<li><a
href="#data-definition-language-ddl-vs-data-manipulation-language-dml"
id="toc-data-definition-language-ddl-vs-data-manipulation-language-dml"><span
class="toc-section-number">3</span> Data Definition Language (DDL) vs
Data Manipulation Language (DML)</a>
<ul>
<li><a href="#examples-of-ddl" id="toc-examples-of-ddl"><span
class="toc-section-number">3.1</span> Examples of DDL</a></li>
<li><a href="#examples-of-dml" id="toc-examples-of-dml"><span
class="toc-section-number">3.2</span> Examples of DML</a></li>
</ul></li>
<li><a href="#version-controlling-a-table"
id="toc-version-controlling-a-table"><span
class="toc-section-number">4</span> Version Controlling a Table</a></li>
<li><a href="#ordering-of-the-verbs"
id="toc-ordering-of-the-verbs"><span class="toc-section-number">5</span>
Ordering of the verbs</a></li>
<li><a href="#using-sql-script-for-analytics"
id="toc-using-sql-script-for-analytics"><span
class="toc-section-number">6</span> Using SQL script for
analytics</a></li>
</ul>
</div>

<div id="why-use-relational-database" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Why use relational
database?</h1>
<p>A relational database is a set of tables (datasets with rows and
columns) that contain information relating to other tables in the
database.</p>
<p>Relational databases have big benefits over simple data storage like
CSV files or data frames, especially when it comes to keeping data neat
and easy to handle. While CSV files can easily get messy with
<strong>repeated information</strong>, relational databases organize
data in tables that connect to each other, which helps avoid having the
same data in more than one place. This setup makes it easier to change
how data is organized without messing up the data itself or the programs
that use it.</p>
<p>Relational databases also let you do complex searches and changes
with SQL, something that’s hard with just CSV files or data frames. They
provide a central place for data, making it easier for many people to
use it at the same time while keeping the data safe and sound, showing
why they’re a go-to choice for managing detailed and interconnected data
in a clean and efficient way.</p>
</div>
<div id="connection-to-a-database" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Connection to a
database</h1>
<p>“Connection to a database will depend on what sort of database we are
working with and what programming language we are using. In this
section, we will explore how to connect to both SQLite and MySQL
databases using Python.</p>
<p>For a local SQLite database, Python’s built-in <code>sqlite3</code>
library provides a straightforward way to connect and interact with
SQLite databases. SQLite is a file-based database, making it an
excellent choice for lightweight applications, development, testing, or
for situations where a simple yet reliable database is required without
the overhead of a full database server.</p>
<pre class="python"><code>import sqlite3

# Connect to the SQLite database (the file)
conn = sqlite3.connect(&#39;movies.db&#39;)

# Create a cursor object
cursor = conn.cursor()</code></pre>
<p>For a local or remote MySQL server, the process involves using a
third-party library like <code>pymysql</code>. MySQL is a more robust
solution suitable for applications requiring concurrent access, advanced
querying capabilities, and higher levels of data integrity and security.
To connect to a MySQL database, you first need to ensure that the MySQL
server is accessible and that you have the necessary credentials
(username, password, database name, and server address).</p>
<pre class="python"><code>import pymysql

# Connection parameters
host = &#39;localhost&#39;  # Or the IP of your MySQL server
user = &#39;your_username&#39;
password = &#39;your_password&#39;
db = &#39;your_database_name&#39;

# Establish a connection to the MySQL database
conn = pymysql.connect(host=host, user=user, password=password, db=db)

# Create a cursor object
cursor = conn.cursor()</code></pre>
<p>After the connection is made, a query can be made using standardized
syntax.</p>
<pre class="python"><code># SQL query to select names and directors from the movies table
query = &quot;SELECT name, director FROM movies&quot;

# Execute the query
cursor.execute(query)

# Fetch all the results
movies = cursor.fetchall()

# Print each movie&#39;s name and director
for movie in movies:
    print(f&quot;Name: {movie[0]}, Director: {movie[1]}&quot;)

# Don&#39;t forget to commit (if you&#39;ve made changes) and close the connection
conn.commit()
conn.close()</code></pre>
</div>
<div id="data-definition-language-ddl-vs-data-manipulation-language-dml"
class="section level1" number="3">
<h1><span class="header-section-number">3</span> Data Definition
Language (DDL) vs Data Manipulation Language (DML)</h1>
<p>In the context of SQL, operations on databases are categorized into
two main types: Data Definition Language (DDL) and Data Manipulation
Language (DML). These categories help organize the types of commands
used to interact with databases and their data.</p>
<div id="examples-of-ddl" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Examples of DDL</h2>
<p>DDL statements are used for defining, altering, and deleting database
objects like tables, indexes, and schemas. Here are some examples:</p>
<ol style="list-style-type: decimal">
<li>CREATE: Used to create a new table or database.</li>
</ol>
<pre class="sql"><code>CREATE TABLE students (
    student_id INT PRIMARY KEY,
    name VARCHAR(100),
    enrollment_date DATE
);</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>ALTER: Used to modify an existing database object, such as adding a
column to a table.</li>
</ol>
<pre class="sql"><code>ALTER TABLE students ADD COLUMN email VARCHAR(255);</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>TRUNCATE: Used to delete all rows in a table without removing the
table itself.</li>
</ol>
<pre class="sql"><code>TRUNCATE TABLE students;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>DROP: Used to delete an object from the database, such as a
table.</li>
</ol>
<pre class="sql"><code>DROP TABLE students;</code></pre>
</div>
<div id="examples-of-dml" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Examples of DML</h2>
<p>DML statements are used for inserting, querying, updating, and
deleting data in the tables. These operations correspond to the CRUD
(Create, Read, Update, Delete) operations. Here are some examples:</p>
<ol style="list-style-type: decimal">
<li>INSERT (Create): Used to insert data into a table.</li>
</ol>
<pre class="sql"><code>INSERT INTO students (student_id, name, enrollment_date)
VALUES (1, &#39;John Doe&#39;, &#39;2021-09-01&#39;);</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>SELECT (Read): Used to query data from a table.</li>
</ol>
<pre class="sql"><code>SELECT * FROM students WHERE student_id = 1;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>UPDATE (Update): Used to modify existing data in a table.</li>
</ol>
<pre class="sql"><code>UPDATE students SET email = &#39;john.doe@example.com&#39; WHERE student_id = 1;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>DELETE (Delete): Used to remove data from a table.</li>
</ol>
<pre class="sql"><code>DELETE FROM students WHERE student_id = 1;</code></pre>
</div>
</div>
<div id="version-controlling-a-table" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Version Controlling a
Table</h1>
<p>When managing databases, it’s often necessary to create a copy or
version of a table. This can be for various reasons such as backup,
testing, or version control purposes. SQL provides a straightforward
method to accomplish this by using a CREATE TABLE AS SELECT statement.
This command creates a new table and populates it with data selected
from another table. This method is particularly useful for creating a
snapshot of the current state of a table, which can serve as a version
control mechanism.</p>
<p>To copy a table, you essentially create a new table with the same
structure and data as the original. This is useful for backup purposes
or when you need a duplicate for testing without affecting the original
data.</p>
<p>Here’s how you can copy a table named
<code>original_table_20230301</code> to a new table called
<code>backup_table</code>:</p>
<pre class="sql"><code>CREATE TABLE original_table_20230301 AS
SELECT *
FROM original_table;</code></pre>
<p>If you only want to copy the structure of that table but not the
data, you can add an additional <code>WHERE 1=0</code> at the end, as
this statement is always evaluated to false, no data will be copied.</p>
</div>
<div id="ordering-of-the-verbs" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Ordering of the
verbs</h1>
<p>When composing SQL queries, the sequence in which you arrange various
clauses is crucial for the database to correctly execute commands and
retrieve data. SQL syntax necessitates a specific order of operations,
and following this hierarchy ensures your queries are both valid and
efficient. Here’s an elaboration of the order of operations in an SQL
query, emphasizing the hierarchy of SQL verbs and including examples for
each:</p>
<ol style="list-style-type: decimal">
<li><p><code>SELECT</code>: Specifies the columns to return. You can
also perform calculations or transformations on the data here (e.g.,
SELECT name, SUM(sales) for aggregate sales by name).</p></li>
<li><p><code>FROM</code>: Indicates the table(s) from which data will be
retrieved (e.g., FROM sales_table). This clause sets the context for the
source of your data.</p></li>
<li><p><code>JOIN</code>: Used for combining rows from two or more
tables based on a related column between them (e.g., JOIN product_table
ON sales_table.product_id = product_table.id). The JOIN clause, which
follows FROM, details the type of join (INNER, LEFT, RIGHT, FULL OUTER)
and the conditions for joining.</p></li>
<li><p><code>WHERE</code>: Filters rows based on specific conditions
(e.g., WHERE sales_date &gt; ‘2023-01-01’). Only rows that meet these
criteria will be included in the output. This clause is applied before
the data is grouped.</p></li>
<li><p><code>GROUP BY</code>: Groups rows that have the same values in
specified columns into summary rows (e.g., GROUP BY product_category).
Essential for aggregate functions (SUM, AVG, MAX, etc.), it organizes
the data into subsets for aggregation.</p></li>
<li><p><code>HAVING</code>: Filters groups of data after they have been
aggregated with GROUP BY (e.g., HAVING SUM(sales) &gt; 1000). WHERE
filters individual rows, HAVING filters aggregated groups.</p></li>
<li><p><code>ORDER BY</code>: Determines the order of the final set of
rows returned, based on one or more columns (e.g., ORDER BY total_sales
DESC). Specifies ascending (ASC) or descending (DESC) order.</p></li>
<li><p><code>LIMIT</code> (or <code>FETCH</code>): Limits the number of
rows returned by the query, useful for handling large datasets or
implementing pagination (e.g., LIMIT 10 for the top 10 rows).</p></li>
<li><p><code>OFFSET</code>: Skips a specified number of rows before
starting to return rows from the query result (e.g., OFFSET 5 to skip
the first 5 rows). Often used with LIMIT for paginated data
retrieval.</p></li>
</ol>
<p>An illustrative SQL query incorporating this order:</p>
<pre class="sql"><code>SELECT product_name, SUM(sales)
FROM sales_table
JOIN product_table ON sales_table.product_id = product_table.id
WHERE sales_date &gt; &#39;2023-01-01&#39;
GROUP BY product_name
HAVING SUM(sales) &gt; 1000
ORDER BY SUM(sales) DESC
LIMIT 10;</code></pre>
<p>This query is designed to identify the top 10 selling products based
on total sales volume from January 1, 2023, onwards, filtering out any
products that have not achieved more than 1000 in sales. The use of a
JOIN operation ensures that the output includes the names of the
products rather than just their IDs.</p>
</div>
<div id="using-sql-script-for-analytics" class="section level1"
number="6">
<h1><span class="header-section-number">6</span> Using SQL script for
analytics</h1>
<p>To execute an analytics query using an external SQL script in Python,
you’ll first need to create the SQL script and save it as a
<code>.sql</code> file. Then, you can use Python to read this script and
execute it against your database. Let’s focus on Step 3 from the
previous example and see how this can be done.</p>
<p>Step 1: Create an External SQL Script Create a file named
<code>analytics_query.sql</code> and include your SQL query for
analytics in it. This file might look like this:</p>
<pre class="sql"><code>-- analytics_query.sql
SELECT 
    p.product_name,
    SUM(s.quantity) AS total_quantity,
    SUM(s.quantity * p.price) AS total_sales
FROM sales s
JOIN products p ON s.product_id = p.product_id
GROUP BY p.product_name
ORDER BY total_sales DESC;</code></pre>
<p>Step 2: Execute the SQL Script in Python</p>
<p>Now, you’ll use Python to read the content of this SQL script and
execute it against your SQLite database. The results will then be
fetched into a Pandas DataFrame for analysis or presentation.</p>
<pre class="python"><code>import sqlite3
import pandas as pd

# Connect to your SQLite database
conn = sqlite3.connect(&#39;:memory:&#39;)  # Assuming you&#39;re using an in-memory database

# Read the SQL script from file
with open(&#39;analytics_query.sql&#39;, &#39;r&#39;) as file:
    analytics_query = file.read()

# Execute the SQL query and fetch the results into a Pandas DataFrame
df = pd.read_sql_query(analytics_query, conn)

# Display the results
print(df)</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
